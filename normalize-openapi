#!/bin/bash

# This script normalizes an OpenAPI v2 document by sorting the paths and definitions
# lexicographically. It uses `jq` to make the transformation.

# Usage: ./normalize-openapi.sh <input_file> <output_file>
# Example: ./normalize-openapi.sh input.json output.json

# Check if the correct number of arguments is provided
if [ "$#" -ne 2 ]; then
    echo "Usage: $0 <input_file> <output_file>"
    exit 1
fi

# Assign input and output file names
input_file="$1"
output_file="$2"

# Check if the input file exists
if [ ! -f "$input_file" ]; then
    echo "Input file not found: $input_file"
    exit 1
fi

# Use jq to sort the paths and definitions lexicographically
jq '{
    swagger: .swagger,
    info: .info,
    host: .host,
    basePath: .basePath,
    schemes: .schemes,
    consumes: .consumes,
    produces: .produces,
    paths: (.paths | to_entries | sort_by(.key) | from_entries),
    definitions: (.definitions | to_entries | sort_by(.key) | from_entries)
}' "$input_file" > "$output_file"

# Check if jq command was successful
if [ $? -ne 0 ]; then
    echo "Error processing the OpenAPI document."
    exit 1
fi

echo "OpenAPI document normalized and saved to $output_file"
